{
  "name": "Plantilla - Notificador Ventas ML",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutes": 5
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Cada 5 Minutos",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [
        250,
        300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.mercadolibre.com/oauth/token",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "grant_type",
              "value": "refresh_token"
            },
            {
              "name": "client_id",
              "value": "[TU_APP_ID_DE_ML]"
            },
            {
              "name": "client_secret",
              "value": "[TU_CLIENT_SECRET_DE_ML]"
            },
            {
              "name": "refresh_token",
              "value": "[REFRESH_TOKEN_DEL_CLIENTE]"
            }
          ]
        }
      },
      "id": "refresh-token-request",
      "name": "1. Renovar Token",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        500,
        300
      ]
    },
    {
      "parameters": {
        "url": "https://api.mercadolibre.com/orders/search?seller=[SELLER_ID_DEL_CLIENTE]&order.status=paid",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "={{ 'Bearer ' + $json.access_token }}"
            }
          ]
        }
      },
      "id": "get-orders-request",
      "name": "2. Consultar Ã“rdenes",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        750,
        300
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.results.length}}",
              "operation": "larger",
              "value2": 0
            }
          ]
        }
      },
      "id": "if-orders-exist",
      "name": "3. Â¿Hay Ã“rdenes Nuevas?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1000,
        300
      ]
    },
    {
      "parameters": {
        "url": "https://api.callmebot.com/whatsapp.php",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "[NUMERO_WHATSAPP_CLIENTE]"
            },
            {
              "name": "apikey",
              "value": "[APIKEY_CALLMEBOT_CLIENTE]"
            },
            {
              "name": "text",
              "value": "ðŸ”” Nueva venta ML!\nProducto: {{$json[\"results\"][0][\"order_items\"][0][\"item\"][\"title\"]}}\nTotal: ${{$json[\"results\"][0][\"total_amount\"]}}\nComprador: {{$json[\"results\"][0][\"buyer\"][\"nickname\"]}}"
            }
          ]
        }
      },
      "id": "send-whatsapp-request",
      "name": "4. Enviar WhatsApp",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1250,
        300
      ]
    }
  ],
  "connections": {
    "schedule-trigger": { "main": [ [ { "node": "refresh-token-request", "type": "main", "index": 0 } ] ] },
    "refresh-token-request": { "main": [ [ { "node": "get-orders-request", "type": "main", "index": 0 } ] ] },
    "get-orders-request": { "main": [ [ { "node": "if-orders-exist", "type": "main", "index": 0 } ] ] },
    "if-orders-exist": { "main": [ [ { "node": "send-whatsapp-request", "type": "main", "index": 0 } ] ] }
  }
}
